<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Promedic</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="css/estilo.css">
    <style>
        .btn-custom {
            color: #fff;
            background-color: #007bff;
            border-color: #007bff;
        }
        .btn-custom:hover {
            color: #fff;
            background-color: #0056b3;
            border-color: #0056b3;
        }
        .promotion-icon, .provider-icon {
            cursor: pointer;
            color: #007bff;
        }
        .promotion-icon:hover, .provider-icon:hover {
            color: #0056b3;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="container-fluid">
        <a class="navbar-brand" href="#"><h2>Promedic</h2></a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="#">Inicio</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="../EstadisticaC/index.html">Estadísticas</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Productos
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="promocion.html">Promociones</a></li>
                        <li><a class="dropdown-item" href="Agregar/Agregar.html">Agregar Producto</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Fórmulas médicas
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="../Recetas_medicas/Registros.html">Fórmulas registradas</a></li>
                    </ul>
                </li>
            </ul>
            <nav class="navbar navbar-light" style="background-color: #ffffff;">
              <div class="container-fluid">
      <!-- Button trigger modal -->
      <button type="button" class="btn btn-outline-primary" data-bs-toggle="modal" data-bs-target="#exampleModal">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bell" viewBox="0 0 16 16">
            <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2M8 1.918l-.797.161A4 4 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4 4 0 0 0-3.203-3.92zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5 5 0 0 1 13 6c0 .88.32 4.2 1.22 6"/>
        </svg>
    </button>
      
      <!-- Modal -->
      <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="exampleModalLabel">Notificaciones</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              Stock de Amoxicilina 500mg está por agotarse
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
            </div>
          </div>
        </div>
      </div>
      <form class="d-flex mx-2" onsubmit="return false;">
        <input class="form-control me-2" type="search" placeholder="Buscar por ID o nombre" aria-label="Search" id="searchInput">
        <button class="btn btn-custom" type="button" onclick="buscarProductos()">Buscar</button>
    </form>
            <div class="dropdown">
              <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownProfileButton" data-bs-toggle="dropdown" aria-expanded="false">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person" viewBox="0 0 16 16">
                  <path d="M8 8a3 3 0 1 0-3-3 3 3 0 0 0 3 3zm0 1a4 4 0 0 0-4 4v1h8v-1a4 4 0 0 0-4-4z"/>
                </svg>
              </button>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownProfileButton">
                <li><a class="dropdown-item" href="http://localhost/PROMEDIC/Iniciar_sesion/Iniciar_sesion.html">Cerrar sesión</a></li>
                <li><a class="dropdown-item" href="http://localhost/PROMEDIC/Rol_Admin/regente_local/Index.html">Gestión de regente</a></li>
                <li><a class="dropdown-item" href="../proveedor_local/index.html">Gestión de Proveedor</a></li>

              </ul>
            </div>
          </div>
        </div>
        
      </nav>
      <nav class="navbar navbar-light" style="background-color: #ffffff;">
        <div class="container-fluid">
<!-- Button trigger modal -->


<!-- Modal -->

          <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
            <div class="offcanvas-header">
              <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Categorías y Clasificaciones</h5>
              <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
              <ul class="navbar-nav justify-content-end flex-grow-1 pe-3" id="menu-list">
                <!-- Menu items will be generated here -->
              </ul>
            </div>
          </div>
        </div>
    </nav>

      

<div class="container mt-5">
  <h1>Lista de Productos</h1>
  <table class="table table-bordered mt-3">
      <thead>
      <tr>
        
          <th>Nombre</th>
          <th>Descripción</th>
          <th>Precio</th>
          <th>Cantidad</th>
          <th>Unidad</th>
          <th>Categoría</th>
          <th>Clasificación</th>
          <th>Fecha de Vencimiento</th>
          <th>Código de Barras</th>
          <th>Marca</th>
          <th>Estado</th>
          <th>Promoción</th>
          <th>Acciones</th>
      </tr>
      </thead>
      <tbody id="productosTableBody">
      <!-- Los productos se agregarán aquí -->
      </tbody>
  </table>
</div>

<!-- Modal para editar producto -->
<div class="modal fade" id="editProductModal" tabindex="-1" aria-labelledby="editProductModalLabel" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
              <h5 class="modal-title" id="editProductModalLabel">Editar Producto</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
              <form id="editProductForm">
                  <input type="hidden" id="editProductIndex">
                  <div class="mb-3">
                      <label for="editNombreProducto" class="form-label">Nombre</label>
                      <input type="text" class="form-control" id="editNombreProducto" required>
                  </div>
                  <div class="mb-3">
                      <label for="editDescripcion" class="form-label">Descripción</label>
                      <input type="text" class="form-control" id="editDescripcion" required>
                  </div>
                  <div class="mb-3">
                      <label for="editPrecio" class="form-label">Precio</label>
                      <input type="number" class="form-control" id="editPrecio" required>
                  </div>
                  <div class="mb-3">
                      <label for="editCantidad" class="form-label">Cantidad</label>
                      <input type="number" class="form-control" id="editCantidad" required>
                  </div>
                  <div class="mb-3">
                      <label for="editUnidad" class="form-label">Unidad</label>
                      <input type="text" class="form-control" id="editUnidad" required>
                  </div>
                  <div class="mb-3">
                      <label for="editCategoria" class="form-label">Categoría</label>
                      <input type="text" class="form-control" id="editCategoria" required>
                  </div>
                  <div class="mb-3">
                      <label for="editClasificacion" class="form-label">Clasificación</label>
                      <input type="text" class="form-control" id="editClasificacion" required>
                  </div>
                
                  <div class="mb-3">
                      <label for="editFechaVencimiento" class="form-label">Fecha de Vencimiento</label>
                      <input type="date" class="form-control" id="editFechaVencimiento" required>
                  </div>
                  <div class="mb-3">
                      <label for="editCodigoBarras" class="form-label">Código de Barras</label>
                      <input type="text" class="form-control" id="editCodigoBarras" required>
                  </div>
                  <div class="mb-3">
                      <label for="editMarca" class="form-label">Marca</label>
                      <input type="text" class="form-control" id="editMarca" required>
                  </div>
                  <div class="mb-3">
                      <label for="editEstado" class="form-label">Estado</label>
                      <input type="text" class="form-control" id="editEstado" required>
                  </div>
                  <div class="mb-3">
                      <label for="editTipoPromocion" class="form-label">Tipo de Promoción</label>
                      <input type="text" class="form-control" id="editTipoPromocion">
                  </div>
                  <div class="mb-3">
                      <label for="editDescuento" class="form-label">Descuento (%)</label>
                      <input type="number" class="form-control" id="editDescuento">
                  </div>
                  <div class="mb-3">
                      <label for="editFechaFinPromocion" class="form-label">Fecha Fin de Promoción</label>
                      <input type="date" class="form-control" id="editFechaFinPromocion">
                  </div>
              </form>
          </div>
          <div class="modal-footer">
              <button type="button" class="btn btn-primary" id="saveChangesBtn">Guardar Cambios</button>
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
          </div>
      </div>
  </div>
</div>

<!-- Modal para información de la promoción -->
<div class="modal fade" id="promotionInfoModal" tabindex="-1" aria-labelledby="promotionInfoModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="promotionInfoModalLabel">Información de Promoción</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body">
        <p><strong>Tipo de Promoción:</strong> <span id="promotionType"></span></p>
        <p><strong>Descuento:</strong> <span id="promotionDiscount"></span>%</p>
        <p><strong>Fecha Fin:</strong> <span id="promotionEndDate"></span></p>
      </div>
    </div>
  </div>
</div>


<script>

// Inicializa la tabla de productos
document.addEventListener('DOMContentLoaded', () => {
    renderizarProductos();
});



   function buscarProductos() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#productosTableBody tr');
            
            rows.forEach(row => {
                const id = row.querySelector('td:nth-child(10)'); // Asumiendo que el ID es el código de barras
                const nombre = row.querySelector('td:first-child');
                
                if (id && nombre) {
                    const idMatch = id.textContent.toLowerCase().includes(searchTerm);
                    const nombreMatch = nombre.textContent.toLowerCase().includes(searchTerm);
                    
                    if (idMatch || nombreMatch) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                }
            });
        }
  
  document.addEventListener('DOMContentLoaded', function () {
    const productosTableBody = document.getElementById('productosTableBody');
    let productos = JSON.parse(localStorage.getItem('productos')) || [];

    // Función para agregar filas a la tabla
    function addRow(producto) {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${producto.nombre}</td>
            <td>${producto.descripcion}</td>
            <td>${producto.precio}</td>
            <td>${producto.cantidad}</td>
            <td>${producto.unidad}</td>
            <td>${producto.categoria}</td>
            <td>${producto.clasificacion}</td>
            <td>${producto.fechaVencimiento}</td>
            <td>${producto.codigoBarras}</td>
            <td>${producto.marca}</td>
            <td>${producto.estado}</td>
            <td>
                ${producto.tipoPromocion && producto.estado === 'promocion' ? 
                    `<span class="promotion-icon" 
                        data-promocion="${producto.tipoPromocion}" 
                        data-descuento="${producto.descuento}" 
                        data-fechaFin="${producto.fechaFinPromocion}" 
                        data-bs-toggle="modal" 
                        data-bs-target="#promotionInfoModal">&#9733;</span>` : 
                    'No aplica'}
            </td>
            <td>
                <button class="btn btn-warning btn-sm edit-btn" data-index="${producto.index}" data-bs-toggle="modal" data-bs-target="#editProductModal">Editar</button>
                <button class="btn btn-danger btn-sm delete-btn" data-index="${producto.index}">Eliminar</button>
            </td>
        `;
        productosTableBody.appendChild(row);
    }

   // ...

// Agrupamiento de productos por categoría y clasificación
const productosAgrupados = {};
productos.forEach((producto, index) => {
  if (!productosAgrupados[producto.categoria]) {
    productosAgrupados[producto.categoria] = {};
  }
  if (!productosAgrupados[producto.categoria][producto.clasificacion]) {
    productosAgrupados[producto.categoria][producto.clasificacion] = [];
  }
  producto.index = index;
  productosAgrupados[producto.categoria][producto.clasificacion].push(producto);
});

// Renderizar la tabla con categorías y clasificaciones
for (const [categoria, clasificaciones] of Object.entries(productosAgrupados)) {
  // Fila para la categoría
  const categoriaRow = document.createElement('tr');
  categoriaRow.innerHTML = `<td colspan="14"><strong>Categoría: ${categoria}</strong></td>`;
  productosTableBody.appendChild(categoriaRow);

  for (const [clasificacion, productosClasificacion] of Object.entries(clasificaciones)) {
    // Fila para la clasificación
    const clasificacionRow = document.createElement('tr');
    clasificacionRow.innerHTML = `<td colspan="14" style="padding-left: 20px;"><strong>Clasificación: ${clasificacion}</strong></td>`;
    productosTableBody.appendChild(clasificacionRow);

    productosClasificacion.forEach(producto => {
      addRow(producto);
    });
  }
}

// Generar menu items dinámicamente
const menuList = document.getElementById('menu-list');
for (const [categoria, clasificaciones] of Object.entries(productosAgrupados)) {
  const categoriaItem = document.createElement('li');
  categoriaItem.innerHTML = `<strong>${categoria}</strong>`;
  menuList.appendChild(categoriaItem);

  const clasificacionesList = document.createElement('ul');
  for (const [clasificacion, productosClasificacion] of Object.entries(clasificaciones)) {
    const clasificacionItem = document.createElement('li');
    clasificacionItem.innerHTML = `<a href="#" data-clasificacion="${clasificacion}">${clasificacion}</a>`;
    clasificacionesList.appendChild(clasificacionItem);
  }
  categoriaItem.appendChild(clasificacionesList);
}

 
    // Manejo del modal de edición
    document.addEventListener('click', function (e) {
        if (e.target.classList.contains('edit-btn')) {
            const index = e.target.getAttribute('data-index');
            const producto = productos[index];
            document.getElementById('editProductIndex').value = index;
            document.getElementById('editNombreProducto').value = producto.nombre || '';
            document.getElementById('editDescripcion').value = producto.descripcion || '';
            document.getElementById('editPrecio').value = producto.precio || '';
            document.getElementById('editCantidad').value = producto.cantidad || '';
            document.getElementById('editUnidad').value = producto.unidad || '';
            document.getElementById('editCategoria').value = producto.categoria || '';
            document.getElementById('editClasificacion').value = producto.clasificacion || '';
            document.getElementById('editFechaVencimiento').value = producto.fechaVencimiento || '';
            document.getElementById('editCodigoBarras').value = producto.codigoBarras || '';
            document.getElementById('editMarca').value = producto.marca || '';
            document.getElementById('editEstado').value = producto.estado || '';
            document.getElementById('editTipoPromocion').value = producto.tipoPromocion || '';
            document.getElementById('editDescuento').value = producto.descuento || '';
            document.getElementById('editFechaFinPromocion').value = producto.fechaFinPromocion || '';
        }
    });

    // Guardar cambios en el producto editado
    document.getElementById('saveChangesBtn').addEventListener('click', function () {
        const index = document.getElementById('editProductIndex').value;
        productos[index] = {
            ...productos[index],
            nombre: document.getElementById('editNombreProducto').value,
            descripcion: document.getElementById('editDescripcion').value,
            precio: document.getElementById('editPrecio').value,
            cantidad: document.getElementById('editCantidad').value,
            unidad: document.getElementById('editUnidad').value,
            categoria: document.getElementById('editCategoria').value,
            clasificacion: document.getElementById('editClasificacion').value,
            fechaVencimiento: document.getElementById('editFechaVencimiento').value,
            codigoBarras: document.getElementById('editCodigoBarras').value,
            marca: document.getElementById('editMarca').value,
            estado: document.getElementById('editEstado').value,
            tipoPromocion: document.getElementById('editTipoPromocion').value || null,
            descuento: document.getElementById('editDescuento').value || null,
            fechaFinPromocion: document.getElementById('editFechaFinPromocion').value || null,
        };
        localStorage.setItem('productos', JSON.stringify(productos));
        location.reload(); // Recargar para mostrar los cambios
    });

    // Manejo del clic en el icono de promoción
    document.addEventListener('click', function (e) {
        if (e.target.classList.contains('promotion-icon')) {
            const tipoPromocion = e.target.getAttribute('data-promocion');
            const descuento = e.target.getAttribute('data-descuento');
            const fechaFin = e.target.getAttribute('data-fechaFin');

            document.getElementById('promotionType').innerText = tipoPromocion;
            document.getElementById('promotionDiscount').innerText = descuento;
            document.getElementById('promotionEndDate').innerText = fechaFin;
        }
    });

    // Manejo del botón de eliminar
    document.addEventListener('click', function (e) {
        if (e.target.classList.contains('delete-btn')) {
            const index = e.target.getAttribute('data-index');
            productos.splice(index, 1); // Eliminar el producto del array
            localStorage.setItem('productos', JSON.stringify(productos)); // Actualizar el localStorage
            location.reload(); // Recargar para mostrar los cambios
        }
    });
});
// Agregar evento para resaltar la ubicación en la tabla
// Agregar evento de clic en la categoría o clasificación
document.addEventListener('DOMContentLoaded', function () {
  const categorias = document.querySelectorAll('#menu-list strong');
  const clasificaciones = document.querySelectorAll('#menu-list a');

  categorias.forEach(categoria => {
    categoria.addEventListener('click', function () {
      const categoriaTexto = categoria.textContent;
      const tabla = document.getElementById('productosTableBody');
      const filas = tabla.getElementsByTagName('tr');
      for (let i = 0; i < filas.length; i++) {
        const fila = filas[i];
        if (fila.cells[5].textContent === categoriaTexto) {
          fila.cells[5].style.background = '#337ab7';
          fila.cells[5].style.color = '#fff';
          setTimeout(function () {
            fila.cells[5].style.background = '';
            fila.cells[5].style.color = '';
          }, 2000);
          // Llevar a la tabla
          tabla.scrollIntoView();
        }
      }
    });
  });

  clasificaciones.forEach(clasificacion => {
    clasificacion.addEventListener('click', function () {
      const clasificacionTexto = clasificacion.textContent;
      const tabla = document.getElementById('productosTableBody');
      const filas = tabla.getElementsByTagName('tr');
      for (let i = 0; i < filas.length; i++) {
        const fila = filas[i];
        if (fila.cells[5].textContent === clasificacionTexto) {
          fila.cells[5].style.background = '#337ab7';
          fila.cells[5].style.color = '#fff';
          setTimeout(function () {
            fila.cells[5].style.background = '';
            fila.cells[5].style.color = '';
          }, 2000);
          // Llevar a la tabla
          tabla.scrollIntoView();
        }
      }
    });
  });
});

  
</script>

<!-- Bootstrap JS y dependencias -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
</body>
</html>