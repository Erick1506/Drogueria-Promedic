<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Arreglar productos</title>
    <link rel="stylesheet" href="diseno.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <div class="container-fluid">
    <a class="navbar-brand" href="#"><h2>Promedic</h2></a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item">
                <a class="nav-link active" aria-current="page" href="http://localhost/PROMEDIC/Rol_Regente/Crud/index.html">Inicio</a>
            </li>
            <li class="nav-item"></li>
                <a class="nav-link active" aria-current="page" href="http://localhost/PROMEDIC/Rol_Regente/proveedor_local/index.html">Proveedores</a>
            </li>
  </nav>
            
    <div class="container d-flex justify-content-center align-items-center vh-100">
        <div class="form-wrapper">
            <div class="form-container">
                <form id="productoForm">
                    <fieldset>
                        <center><legend>Agregar productos</legend></center>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="nombreProducto" class="form-label">Nombre</label>
                                <input type="text" id="nombreProducto" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label for="descripcionProducto" class="form-label">Descripción</label>
                                <input type="text" id="descripcionProducto" class="form-control">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="precioProducto" class="form-label">Precio</label>
                                <input type="number" id="precioProducto" class="form-control" step="0.01" required>
                            </div>
                            <div class="col-md-6">
                                <label for="cantidadProducto" class="form-label">Cantidad</label>
                                <div class="input-group">
                                    <input type="number" id="cantidadProducto" class="form-control" required>
                                    <select class="form-select" id="unidadCantidad">
                                        <option value="unidades">Unidades</option>
                                        <option value="cajas">Cajas</option>
                                        <option value="paquetes">Paquetes</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="cantidadMinima" class="form-label">Cantidad Mínima de Stock</label>
                                <input type="number" id="cantidadMinima" class="form-control" required>
                            </div>
                            <div class="col-md-6">
                                <label for="cantidadMaxima" class="form-label">Cantidad Máxima de Stock</label>
                                <input type="number" id="cantidadMaxima" class="form-control" required>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="fechaVencimiento" class="form-label">Fecha de Vencimiento</label>
                                <input type="date" id="fechaVencimiento" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label for="codigoBarras" class="form-label">Código de Barras</label>
                                <input type="text" id="codigoBarras" class="form-control">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="marcaProducto" class="form-label">Marca</label>
                                <input type="text" id="marcaProducto" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label for="estadoProducto" class="form-label">Estado del producto</label>
                                <select class="form-select" id="estadoProducto" required>
                                    <option value="" selected disabled>Seleccionar estado</option>
                                    <option value="disponible">Disponible</option>
                                    <option value="promocion">Promoción</option>
                                    <option value="agotado">Agotado</option>
                                </select>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="categoriaProducto" class="form-label">Categoría</label>
                                <div class="input-group">
                                    <select class="form-select" id="categoriaProducto" required>
                                        <option value="" selected disabled>Seleccionar categoría</option>
                                    </select>
                                    <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#modalNuevaCategoria">+</button>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="clasificacionProducto" class="form-label">Clasificación</label>
                                <div class="input-group">
                                    <select class="form-select" id="clasificacionProducto" required>
                                        <option value="" selected disabled>Seleccionar clasificación</option>
                                    </select>
                                    <button type="button" class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#modalNuevaClasificacion">+</button>
                                </div>
                            </div>
                        </div>
                        <div class="container-input mb-3">
                            <label for="select-proveedor">Seleccionar Proveedor:</label>
                            <select id="select-proveedor" required>
                                <option value="">Seleccionar proveedor</option>
                                <!-- Las opciones se llenarán automáticamente -->
                            </select>
                        </div>
                        <div class="row mb-3" id="promocionSection" style="display:none;">
                            <div class="col-md-6">
                                <label for="fechaFinPromocion" class="form-label">Fecha Fin de Promoción</label>
                                <input type="date" id="fechaFinPromocion" class="form-control">
                            </div>
                            <div class="col-md-6">
                                <label for="tipoPromocion" class="form-label">Tipo de Promoción</label>
                                <select class="form-select" id="tipoPromocion">
                                    <option value="dos_por_uno">2 por 1</option>
                                    <option value="descuento">Descuento</option>
                                </select>
                            </div>
                            <div class="col-md-6" id="descuentoField" style="display: none;">
                                <label for="descuento" class="form-label">Descuento (%)</label>
                                <input type="number" id="descuento" class="form-control" step="0.01">
                            </div>
                        </div>
                        <center>
                            <button type="submit" class="btn btn-primary">Agregar</button>
                            <button type="button" class="btn btn-secondary" onclick="window.history.back()">Cancelar</button>
                        </center>
                    </fieldset>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Nueva categoría -->
    <div class="modal fade" id="modalNuevaCategoria" tabindex="-1" aria-labelledby="modalNuevaCategoriaLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalNuevaCategoriaLabel">Nueva categoría</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <label for="nuevaCategoria" class="form-label">Nombre de la nueva categoría</label>
                    <input type="text" id="nuevaCategoria" class="form-control">
                </div>
                <div class="modal-body">
                    <label for="nuevaCategoriaDescripcion" class="form-label">Descripción de la nueva categoría</label>
                    <input type="text" id="nuevaCategoriaDescripcion" class="form-control">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="guardarCategoria">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nueva Clasificación -->
    <div class="modal fade" id="modalNuevaClasificacion" tabindex="-1" aria-labelledby="modalNuevaClasificacionLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalNuevaClasificacionLabel">Nueva Clasificación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <label for="nuevaClasificacion" class="form-label">Nombre de la nueva clasificación</label>
                    <input type="text" id="nuevaClasificacion" class="form-control">
                </div>
                <div class="modal-body">
                    <label for="nuevaClasificacionDescripcion" class="form-label">Descripción de la nueva clasificación</label>
                    <input type="text" id="nuevaClasificacionDescripcion" class="form-control">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="guardarClasificacion">Guardar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nuevo Proveedor -->

     <!--
    <div class="modal fade" id="modalNuevoProveedor" tabindex="-1" aria-labelledby="modalNuevoProveedorLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalNuevoProveedorLabel">Nuevo Proveedor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <label for="nuevoProveedor" class="form-label">Nombre del nuevo proveedor</label>
                    <input type="text" id="nuevoProveedor" class="form-control">
                </div>
                <div class="modal-body">
                    <label for="nuevoProveedorCorreo" class="form-label">Correo electrónico</label>
                    <input type="email" id="nuevoProveedorCorreo" class="form-control">
                </div>
                <div class="modal-body">
                    <label for="nuevoProveedorTelefono" class="form-label">Teléfono</label>
                    <input type="text" id="nuevoProveedorTelefono" class="form-control">
                </div>
                <div class="modal-body">
                    <label for="nuevoProveedorDireccion" class="form-label">Dirección</label>
                    <input type="text" id="nuevoProveedorDireccion" class="form-control">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" id="guardarProveedor">Guardar</button>
                </div>
            </div>
        </div>
    </div>
    -->

    
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
       <script>

        document.addEventListener('DOMContentLoaded', () => {
            const cargarProveedores = () => {
                return JSON.parse(localStorage.getItem('proveedores')) || [];
            };
    
            const cargarSelectProveedores = () => {
                const proveedores = cargarProveedores();
                const selectProveedor = document.querySelector('#select-proveedor'); // Cambiado aquí
    
                proveedores.forEach(proveedor => {
                    const option = document.createElement('option');
                    option.value = proveedor.id; // El ID del proveedor
                    option.textContent = proveedor.nombre; // El nombre del proveedor
                    selectProveedor.appendChild(option);
                });
            };
            cargarSelectProveedores();

        });

    document.addEventListener('DOMContentLoaded', function() {
        const categoriaSelect = document.getElementById('categoriaProducto');
        const clasificacionSelect = document.getElementById('clasificacionProducto');
        const proveedorSelect = document.getElementById('proveedorProducto');
        const guardarCategoria = document.getElementById('guardarCategoria');
        const guardarClasificacion = document.getElementById('guardarClasificacion');
        const guardarProveedor = document.getElementById('guardarProveedor');
        const estadoProducto = document.getElementById('estadoProducto');
        const promocionSection = document.getElementById('promocionSection');
        const tipoPromocion = document.getElementById('tipoPromocion');
        const descuentoField = document.getElementById('descuentoField');
        const productoForm = document.getElementById('productoForm');
    
        // Cargar datos desde localStorage
        function loadOptions() {
            const categorias = JSON.parse(localStorage.getItem('categorias')) || [];
            const clasificaciones = JSON.parse(localStorage.getItem('clasificaciones')) || [];
            const proveedores = JSON.parse(localStorage.getItem('proveedores')) || [];
    
            categorias.forEach(categoria => {
                const option = document.createElement('option');
                option.value = categoria;
                option.textContent = categoria;
                categoriaSelect.appendChild(option);
            });
    
            clasificaciones.forEach(clasificacion => {
                const option = document.createElement('option');
                option.value = clasificacion;
                option.textContent = clasificacion;
                clasificacionSelect.appendChild(option);
            });
    
            proveedores.forEach(proveedor => {
                const option = document.createElement('option');
                option.value = proveedor;
                option.textContent = proveedor;
                proveedorSelect.appendChild(option);
            });
        }
    
        // Guardar y actualizar las opciones en localStorage
        function saveOption(key, value) {
            const items = JSON.parse(localStorage.getItem(key)) || [];
            if (!items.includes(value)) {
                items.push(value);
                localStorage.setItem(key, JSON.stringify(items));
            }
        }
    
        function updatePromocionSection() {
            if (estadoProducto.value === 'promocion') {
                promocionSection.style.display = 'block';
            } else {
                promocionSection.style.display = 'none';
                // Reinicia el tipo de promoción
                tipoPromocion.value = 'dos_por_uno'; // O cualquier valor predeterminado que prefieras
            }
        }
        
    
        function updateDescuentoField() {
            if (tipoPromocion.value === 'descuento') {
                descuentoField.style.display = 'block';
            } else {
                descuentoField.style.display = 'none';
            }
        }
    
        estadoProducto.addEventListener('change', updatePromocionSection);
        tipoPromocion.addEventListener('change', updateDescuentoField);
    
        guardarCategoria.addEventListener('click', function() {
            const nuevaCategoria = document.getElementById('nuevaCategoria').value.trim();
            if (nuevaCategoria) {
                const option = document.createElement('option');
                option.value = nuevaCategoria;
                option.textContent = nuevaCategoria;
                categoriaSelect.appendChild(option);
                $('#modalNuevaCategoria').modal('hide');
                document.getElementById('nuevaCategoria').value = ''; // Limpiar campo
                saveOption('categorias', nuevaCategoria); // Guardar en localStorage
            }
        });
    
        guardarClasificacion.addEventListener('click', function() {
            const nuevaClasificacion = document.getElementById('nuevaClasificacion').value.trim();
            if (nuevaClasificacion) {
                const option = document.createElement('option');
                option.value = nuevaClasificacion;
                option.textContent = nuevaClasificacion;
                clasificacionSelect.appendChild(option);
                $('#modalNuevaClasificacion').modal('hide');
                document.getElementById('nuevaClasificacion').value = ''; // Limpiar campo
                saveOption('clasificaciones', nuevaClasificacion); // Guardar en localStorage
            }
        });
    
        productoForm.addEventListener('submit', function(event) {
            event.preventDefault(); // Evita el envío del formulario tradicional
    
            // Verifica si el estado es 'promocion' y si no se seleccionó, se asigna 'disponible'
            const estado = estadoProducto.value === 'promocion' ? 'promocion' : 'disponible';
    
            const producto = {
                nombre: document.getElementById('nombreProducto').value,
                descripcion: document.getElementById('descripcionProducto').value,
                precio: document.getElementById('precioProducto').value,
                cantidad: document.getElementById('cantidadProducto').value,
                unidad: document.getElementById('unidadCantidad').value,
                cantidadMinima: document.getElementById('cantidadMinima').value,
                cantidadMaxima: document.getElementById('cantidadMaxima').value,
                fechaVencimiento: document.getElementById('fechaVencimiento').value,
                codigoBarras: document.getElementById('codigoBarras').value,
                marca: document.getElementById('marcaProducto').value,
                estado: estado, // Estado definido aquí
                categoria: document.getElementById('categoriaProducto').value,
                clasificacion: document.getElementById('clasificacionProducto').value,
                fechaFinPromocion: document.getElementById('fechaFinPromocion').value,
                tipoPromocion: document.getElementById('tipoPromocion').value,
                descuento: document.getElementById('descuento').value

            };
    
            let productos = JSON.parse(localStorage.getItem('productos')) || [];
            productos.push(producto);
            localStorage.setItem('productos', JSON.stringify(productos));
    
            // Redireccionar o limpiar el formulario
            window.location.href = 'http://localhost/PROMEDIC/Rol_Admin/Crud/index.html'; // Redirige a la página de índice
        });
    
        // Cargar las opciones al cargar la página
        loadOptions();
    
    });
    const procesarProducto = (e) => {
        e.preventDefault();
    
        const nombre = document.getElementById('nombre-producto').value;
        const proveedorId = document.getElementById('proveedor-select').value;
    
        const productos = cargarProductos(); // Asegúrate de tener esta función
    
        productos.push({
            nombre,
            descripcion,
            precio,
            cantidad,
            unidad,
            cantidadMinima,
            cantidadMaxima,
            fechaVencimiento,
            codigoBarras,
            marca,
            estado: estado,
            categoria,
            clasificacion,
            proveedor,
            fechaFinPromocion,
            tipoPromocion ,
            descuento
        });
    
        guardarProductos(productos); // Asegúrate de tener esta función para guardar productos
        e.target.reset();
    };
    
    // Añadir el evento al formulario
    document.getElementById('form-agregar-producto').addEventListener('submit', procesarProducto);
    </script>
    
</body>
</html>